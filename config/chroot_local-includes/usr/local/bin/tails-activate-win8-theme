#!/bin/sh

# This script sets up the live user's Gnome theme to something that
# resembles Microsoft Windows 8.

# Set IE icon in iceweasel
# XXX: doesn't work as amnesia
#ie_icon="/usr/share/icons/GnomeXP/48x48/apps/iceweasel.png"
#for x in /usr/share/iceweasel/browser/chrome/icons/default/*; do
#	rm ${x}
#	ln -s ${ie_icon} ${x}
#done

# Iceweasel
# Copy the file containing toolbars configurations
cp /usr/share/tails/firefox-localstore-win8.rdf ${HOME}/.mozilla/firefox/default/localstore.rdf
# Setup a blue lightweight theme
cat >> ${HOME}/.mozilla/firefox/default/user.js <<EOF
user_pref("lightweightThemes.isThemeSelected", true);
user_pref("lightweightThemes.usedThemes", "[{\"id\":\"1\",\"name\":\"Unsafe Browser\",\"headerURL\":\"file:///usr/share/pixmaps/blue_dot.png\",\"footerURL\":\"file:///usr/share/pixmaps/blue_dot.png\",\"textcolor\":\"#FFFFFF\",\"accentcolor\":\"#3399FF\",\"updateDate\":0,\"installDate\":0}]");
EOF

# Remove Tails-specific desktop icons
rm --interactive=never -f ${HOME}/Desktop/*.desktop 2> /dev/null || true

# The part below is based on the XpGnome installation script, written
# by PhrankDaChicken, available from http://ubunut.online02.com/xpgnome

# Icon theme
gsettings set org.gnome.desktop.interface icon-theme Windows8

# Cursor theme
gsettings set org.gnome.desktop.interface cursor-theme Windows8

# GTK theme
gsettings set org.gnome.desktop.interface gtk-theme Windows8

# Metacity theme
gsettings set org.gnome.desktop.wm.preferences theme Windows8

# Toolbars - Icons Only
gsettings set org.gnome.desktop.interface toolbar-style icons

# Desktop Icons
gsettings set org.gnome.nautilus.desktop computer-icon-visible false
gsettings set org.gnome.nautilus.desktop home-icon-visible false
gsettings set org.gnome.nautilus.desktop network-icon-visible false
gsettings set org.gnome.nautilus.desktop trash-icon-visible true
gsettings set org.gnome.nautilus.desktop volumes-visible true
# FIXME: Localization needed below
gsettings set org.gnome.nautilus.desktop trash-icon-name "Recycle Bin"

# Background
gsettings set org.gnome.desktop.background picture-uri file:///usr/share/pixmaps/backgrounds/Windows8.jpg
gsettings set org.gnome.desktop.background picture-options stretched

# Only one workspace
gsettings set org.gnome.desktop.wm.preferences num-workspaces 1

# Panel
gsettings set org.gnome.gnome-panel.layout object-id-list "['menu-button', 'iceweasel-launcher', 'claws-launcher', 'pidgin-launcher', 'keepassx-launcher', 'gnome-terminal-launcher', 'window-list', 'notification-area', 'shutdown-helper', 'clock']"
gsettings set org.gnome.gnome-panel.layout toplevel-id-list "['bottom-panel']"
gsettings set org.gnome.desktop.lockdown disable-log-out true

# Window picker config
gsettings set org.gnome.window-picker-applet expand-task-list true

# Panel objects - there is no schema so we can't use gsettings
dconf write /org/gnome/gnome-panel/layout/objects/menu-button/object-iid '"PanelInternalFactory::MenuButton"'
dconf write /org/gnome/gnome-panel/layout/objects/menu-button/pack-index '0'
dconf write /org/gnome/gnome-panel/layout/objects/menu-button/pack-type '"start"'
dconf write /org/gnome/gnome-panel/layout/objects/menu-button/toplevel-id '"bottom-panel"'
dconf write /org/gnome/gnome-panel/layout/objects/home-launcher/object-iid '"PanelInternalFactory::Launcher"'
dconf write /org/gnome/gnome-panel/layout/objects/home-launcher/pack-index '1'
dconf write /org/gnome/gnome-panel/layout/objects/home-launcher/pack-type '"start"'
dconf write /org/gnome/gnome-panel/layout/objects/home-launcher/toplevel-id '"bottom-panel"'
dconf write /org/gnome/gnome-panel/layout/objects/home-launcher/instance-config/location '"/usr/share/applications/nautilus.desktop"'
dconf write /org/gnome/gnome-panel/layout/objects/iceweasel-launcher/pack-index '2'
dconf write /org/gnome/gnome-panel/layout/objects/iceweasel-launcher/pack-type '"start"'
dconf write /org/gnome/gnome-panel/layout/objects/iceweasel-launcher/toplevel-id '"bottom-panel"'
dconf write /org/gnome/gnome-panel/layout/objects/claws-launcher/pack-index '3'
dconf write /org/gnome/gnome-panel/layout/objects/claws-launcher/pack-type '"start"'
dconf write /org/gnome/gnome-panel/layout/objects/claws-launcher/toplevel-id '"bottom-panel"'
dconf write /org/gnome/gnome-panel/layout/objects/pidgin-launcher/pack-index '4'
dconf write /org/gnome/gnome-panel/layout/objects/pidgin-launcher/pack-type '"start"'
dconf write /org/gnome/gnome-panel/layout/objects/pidgin-launcher/toplevel-id '"bottom-panel"'
dconf write /org/gnome/gnome-panel/layout/objects/window-list/object-iid '"WindowPickerFactory::WindowPicker"'
dconf write /org/gnome/gnome-panel/layout/objects/window-list/pack-index '5'
dconf write /org/gnome/gnome-panel/layout/objects/window-list/pack-type '"start"'
dconf write /org/gnome/gnome-panel/layout/objects/window-list/toplevel-id '"bottom-panel"'
dconf write /org/gnome/gnome-panel/layout/objects/notification-area/pack-index '2'
dconf write /org/gnome/gnome-panel/layout/objects/notification-area/pack-type '"end"'
dconf write /org/gnome/gnome-panel/layout/objects/notification-area/toplevel-id '"bottom-panel"'
dconf write /org/gnome/gnome-panel/layout/objects/shutdown-helper/pack-index '1'
dconf write /org/gnome/gnome-panel/layout/objects/shutdown-helper/pack-type '"end"'
dconf write /org/gnome/gnome-panel/layout/objects/shutdown-helper/toplevel-id '"bottom-panel"'
dconf write /org/gnome/gnome-panel/layout/objects/clock/pack-index '0'
dconf write /org/gnome/gnome-panel/layout/objects/clock/toplevel-id '"bottom-panel"'
dconf write /org/gnome/gnome-panel/layout/objects/clock/pack-type '"end"'

# Panel toplevels - there is no schema so we can't use gsettings.
# Note that the height must be set after adding the object to the
# panel since some of them, like window-picket-applet, seem to reset
# it.
dconf write /org/gnome/gnome-panel/layout/toplevels/bottom-panel/size '48'

# Restart the panel
# XXX this is ugly
pkill gnome-panel
